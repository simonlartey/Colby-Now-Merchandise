<div class="col-lg-12">
    <div class="card border-0 shadow-sm">
        <div class="card-body d-flex align-items-center justify-content-between flex-wrap gap-3">

            <!-- IMAGE -->
            <div style="width: 80px; height: 80px; flex-shrink: 0;">
                {% if order.item.image_url %}
                <img src="{{ url_for('static', filename=order.item.image_url) }}"
                     class="w-100 h-100 rounded object-fit-cover">
                {% else %}
                <div class="w-100 h-100 bg-light rounded d-flex align-items-center justify-content-center">
                    <i class="bi bi-image text-muted"></i>
                </div>
                {% endif %}
            </div>

            <!-- INFO -->
            <div>
                <h6 class="mb-1 fw-bold">{{ order.item.title }}</h6>
                <p class="mb-0 text-muted small">
                    Buyer: <strong>{{ order.buyer.name }}</strong>

                    {% if order.status == "pending" %}
                        <span class="badge bg-warning ms-2">Pending</span>

                    {% elif order.status == "paid_pending_pickup" %}
                        <span class="badge bg-primary ms-2">Paid â€” Awaiting Pickup</span>

                    {% elif order.status == "approved" %}
                        <span class="badge bg-success ms-2">Pickup Approved</span>

                    {% elif order.status == "delivered" %}
                        <span class="badge bg-secondary ms-2">Completed</span>
                    {% endif %}
                </p>

                <small class="text-primary fw-medium">
                    Price: ${{ "%.2f"|format(order.item.price) }}
                </small>
            </div>

            <!-- DETAILS -->
            <div class="flex-grow-1 px-md-4 border-start border-end mx-md-3 d-none d-md-block">
                <div class="row g-2">

                    <div class="col-6">
                        <p class="mb-0 small text-muted">Location</p>
                        <p class="mb-0 small fw-medium">{{ order.location }}</p>
                    </div>

                    <div class="col-6">
                        <p class="mb-0 small text-muted">Payment</p>
                        <p class="mb-0 small fw-medium">{{ order.payment_method }}</p>
                    </div>

                    {% if order.notes %}
                    <div class="col-12 mt-2">
                        <p class="mb-0 small text-muted fst-italic">"{{ order.notes }}"</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="d-flex gap-2">

                {% if order.status == "pending" %}
                    <!-- Old negotiation system -->
                    <form action="{{ url_for('main.handle_order', order_id=order.id, action='approve') }}" method="POST">
                        <button class="btn btn-success btn-sm px-3">Approve</button>
                    </form>
                    <form action="{{ url_for('main.handle_order', order_id=order.id, action='reject') }}" method="POST">
                        <button class="btn btn-outline-danger btn-sm px-3">Reject</button>
                    </form>

                {% elif order.status == "paid_pending_pickup" %}
                    <!-- STEP 1: Approve pickup after payment -->
                    <form action="{{ url_for('main.approve_pickup', order_id=order.id) }}" method="POST">
                        <button class="btn btn-outline-primary btn-sm px-3">Approve Pickup</button>
                    </form>

                {% elif order.status == "approved" %}
                    <!-- STEP 2: Complete order -->
                    <form action="{{ url_for('main.complete_order', order_id=order.id) }}" method="POST">
                        <button class="btn btn-success btn-sm px-3">Mark Completed</button>
                    </form>

                {% else %}
                    <span class="text-muted small">Processed</span>
                {% endif %}

            </div>
        </div>
    </div>
</div>
